<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å°æ¸¸æˆå¹³å°</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="app" class="container mx-auto px-4 py-12" v-cloak>
        <header class="text-center mb-16">
            <h1 class="text-5xl font-extrabold mb-4 bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                Mini-Game HUB
            </h1>
            <p class="text-gray-400">é€‰æ‹©ä¸€ä¸ªæ¸¸æˆï¼Œå¼€å¯ä½ çš„ä¼‘é—²æ—¶å…‰</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div v-for="game in games" :key="game.id"
                 class="bg-gray-800 rounded-2xl p-6 border border-gray-700 hover:border-blue-500 transition-all transform hover:-translate-y-2 cursor-pointer shadow-xl">
                <div class="text-4xl mb-4">{{ game.icon }}</div>
                <h3 class="text-2xl font-bold mb-2">{{ game.name }}</h3>
                <p class="text-gray-400 mb-6 leading-relaxed">{{ game.desc }}</p>
                <a :href="game.url"
                   class="inline-block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition">
                    ç«‹å³å¼€å§‹
                </a>
                <button @click="showLeaderboard(game.id)" class="mt-4 w-full text-blue-400 hover:text-blue-300 text-sm font-semibold transition">
                  ğŸ† æŸ¥çœ‹æ’è¡Œæ¦œ
                </button>
            </div>
        </div>

        <div v-if="currentBoard.length > 0" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div class="bg-gray-800 rounded-2xl p-8 max-w-md w-full border border-gray-700 shadow-2xl">
                <h2 class="text-2xl font-bold mb-4 flex justify-between">
                    æ’è¡Œæ¦œ <span>ğŸ†</span>
                </h2>
                <div class="max-h-64 overflow-y-auto">
                    <div v-for="(s, index) in currentBoard" :key="index" class="flex justify-between py-2 border-b border-gray-700">
                        <span><span class="text-gray-500 mr-2">{{ index + 1 }}</span>{{ s.player_name }}</span>
                        <span class="text-blue-400 font-bold">{{ s.score }}</span>
                    </div>
                </div>
                <button @click="currentBoard = []" class="mt-6 w-full bg-gray-700 hover:bg-gray-600 py-2 rounded-lg transition">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue
        createApp({
            setup() {
                const games = ref([])
                const currentBoard = ref([])

                const fetchGames = async () => {
                    try {
                        const res = await fetch('/api/games') // ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ›´ç¨³å¥
                        games.value = await res.json()
                    } catch (e) { console.error("åŠ è½½æ¸¸æˆå¤±è´¥", e) }
                }

                // ä¿®å¤2ï¼šå‡½æ•°å¿…é¡»å†™åœ¨ setup å†…éƒ¨å¹¶è¿”å›
                const showLeaderboard = async (gameId) => {
                    try {
                        const res = await fetch(`/api/scores/${gameId}`)
                        currentBoard.value = await res.json()
                        // å¦‚æœæ²¡æ•°æ®ï¼Œç»™ä¸ªæç¤º
                        if(currentBoard.value.length === 0) alert("è¯¥æ¸¸æˆæš‚æ— æ’è¡Œæ•°æ®")
                    } catch (e) { console.error("åŠ è½½æ¦œå•å¤±è´¥", e) }
                }

                onMounted(fetchGames)

                return {
                    games,
                    currentBoard,
                    showLeaderboard
                }
            }
        }).mount('#app')
    </script>
    <style>[v-cloak] { display: none; }</style>
</body>
</html>